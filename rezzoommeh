<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>رزومه ساز دانیال (نسخه اصلاح شده)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
<style>
    :root {
        --primary: #004a99; /* آبی سرمه‌ای */
        --secondary: #00aaff; /* آبی روشن */
        --sidebar-bg: #f8fafc;
        --border-color: #e2e8f0;
    }

    * { box-sizing: border-box; outline: none; }
    body { 
        margin: 0; padding: 0; 
        font-family: 'Vazir', sans-serif; 
        background-color: #333; 
        height: 100vh; 
        display: flex; 
        overflow: hidden;
    }

    /* --- پنل تنظیمات (سمت راست صفحه نمایش) --- */
    .editor-sidebar {
        width: 400px;
        background: #1e293b;
        color: white;
        padding: 15px;
        overflow-y: auto;
        border-left: 3px solid var(--secondary);
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 100;
        box-shadow: -5px 0 15px rgba(0,0,0,0.3);
    }

    .group-box {
        background: rgba(255,255,255,0.05);
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .group-box h4 { margin: 0 0 10px 0; color: var(--secondary); font-size: 14px; border-bottom: 1px dashed #555; padding-bottom: 5px; }

    input, textarea {
        background: #334155; border: 1px solid #475569; color: white;
        padding: 8px; border-radius: 4px; font-family: 'Vazir'; font-size: 13px; width: 100%; margin-bottom: 5px;
    }
    input:focus, textarea:focus { border-color: var(--secondary); background: #475569; }

    .btn {
        width: 100%; padding: 8px; border: none; border-radius: 4px; cursor: pointer;
        font-family: 'Vazir'; font-size: 13px; margin-top: 5px; color: white; transition: 0.2s;
    }
    .btn-green { background: #22c55e; }
    .btn-red { background: #ef4444; width: auto; font-size: 11px; padding: 4px 8px; float: left; }
    .btn-blue { background: var(--secondary); font-weight: bold; font-size: 15px; margin-bottom: 10px; }
    .btn-orange { background: #f59e0b; }
    .btn-purple { background: #6366f1; }
    
    .row-btns { display: flex; gap: 5px; }

    /* --- محیط پیش‌نمایش (سمت چپ) --- */
    .preview-area {
        flex: 1;
        background: #525659;
        overflow-y: auto;
        padding: 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }

    /* --- کاغذ A4 --- */
    .a4-page {
        width: 210mm;
        height: 297mm; /* ارتفاع ثابت A4 */
        background: white;
        position: relative;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        overflow: hidden; /* مخفی کردن سرریز */
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
    }

    /* --- لی‌آوت رزومه (طرح دانیال) --- */
    /* هدر آبی */
    .header-top {
        height: 150px;
        position: relative;
        width: 100%;
    }
    .wave-shape {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: var(--primary);
        clip-path: polygon(0 0, 100% 0, 100% 75%, 0% 100%);
        z-index: 1;
    }
    .wave-shape-light {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: var(--secondary);
        clip-path: polygon(0 0, 100% 0, 100% 65%, 0% 100%);
        z-index: 0;
    }

    .header-content {
        position: relative;
        z-index: 10;
        padding: 30px 40px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        height: 100%;
    }
    
    .header-text { width: 60%; color: white; padding-top: 10px; }
    .header-text h1 { margin: 0; font-size: 30px; font-weight: bold; }
    .header-text p { margin: 5px 0 0 0; font-size: 16px; opacity: 0.9; }

    /* عکس پروفایل */
    .photo-box {
        width: 130px; height: 130px;
        border-radius: 50%;
        border: 5px solid white;
        overflow: hidden;
        background: white;
        position: absolute;
        left: 40px;
        top: 30px;
        z-index: 20;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .photo-box img { width: 100%; height: 100%; object-fit: cover; }

    /* بدنه دو ستونه */
    .main-body {
        display: flex;
        flex: 1;
        position: relative;
    }

    /* ستون راست (اطلاعات تماس و مهارت) - در HTML اول میاید */
    .col-sidebar {
        width: 35%;
        background: var(--sidebar-bg);
        border-left: 1px solid var(--border-color); /* خط جداکننده */
        padding: 70px 20px 20px 20px; /* پدینگ بالا برای رد شدن از عکس */
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* ستون چپ (سوابق) */
    .col-content {
        width: 65%;
        padding: 30px 30px 30px 20px;
    }

    /* اگر صفحه دوم باشد، پدینگ سایدبار کم میشود */
    .a4-page.page-next .header-top { display: none; }
    .a4-page.page-next .col-sidebar { padding-top: 30px; }
    .a4-page.page-next .col-content { padding-top: 40px; }
    .a4-page.page-next .photo-box { display: none; }

    /* استایل المان‌ها */
    .sec-title {
        width: 100%;
        color: #333;
        font-weight: bold;
        font-size: 15px;
        border-bottom: 2px solid var(--secondary);
        padding-bottom: 5px;
        margin-bottom: 15px;
        display: flex; align-items: center; gap: 8px;
    }
    .sec-title i { color: var(--secondary); font-size: 18px; }

    /* تماس */
    .contact-row {
        width: 100%; display: flex; align-items: center; justify-content: flex-end; gap: 10px;
        margin-bottom: 10px; font-size: 12px; color: #444; text-align: left;
    }
    .contact-row span { text-align: left; }
    .contact-row i { color: #555; width: 20px; text-align: center; }

    /* مهارت */
    .skill-row { width: 100%; margin-bottom: 12px; }
    .skill-txt { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; font-weight: bold; }
    .skill-bar { width: 100%; height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; }
    .skill-fill { height: 100%; background: var(--secondary); }

    /* سوابق */
    .job-item {
        position: relative;
        padding-right: 20px;
        margin-bottom: 25px;
        border-right: 2px solid #eee;
    }
    .job-item::before {
        content: ''; position: absolute; right: -6px; top: 5px;
        width: 10px; height: 10px; background: var(--secondary);
        border-radius: 50%;
    }
    .job-title { font-weight: bold; font-size: 14px; color: #000; }
    .job-sub { font-size: 12px; color: var(--primary); margin: 2px 0; }
    .job-date { font-size: 11px; color: #777; display: block; margin-bottom: 5px; }
    .job-desc { font-size: 12px; color: #444; text-align: justify; line-height: 1.6; }

    .about-txt { font-size: 13px; text-align: justify; line-height: 1.8; color: #444; margin-bottom: 20px; }

    /* --- پرینت --- */
    @media print {
        body { background: white; height: auto; display: block; overflow: visible; }
        .editor-sidebar { display: none; }
        .preview-area { padding: 0; background: white; display: block; }
        .a4-page { margin: 0; box-shadow: none; page-break-after: always; }
        .a4-page:last-child { page-break-after: auto; }
    }
</style>
</head>
<body>

<div class="editor-sidebar">
    <button class="btn btn-blue" onclick="window.print()"><i class="fas fa-print"></i> دانلود PDF / چاپ</button>
    <div class="row-btns">
        <button class="btn btn-orange" onclick="saveData()"><i class="fas fa-save"></i> ذخیره پروژه (.sedat)</button>
        <button class="btn btn-purple" onclick="document.getElementById('loadIn').click()"><i class="fas fa-folder-open"></i> بازکردن</button>
        <input type="file" id="loadIn" style="display:none" onchange="loadData(this)" accept=".sedat">
    </div>

    <div class="group-box">
        <h4>اطلاعات پایه</h4>
        <input placeholder="نام و نام خانوادگی" id="in_name" oninput="update('name', this.value)">
        <input placeholder="عنوان شغلی" id="in_job" oninput="update('job', this.value)">
        <textarea rows="4" placeholder="درباره من" id="in_about" oninput="update('about', this.value)"></textarea>
        <button class="btn" style="background:#475569" onclick="document.getElementById('imgIn').click()">انتخاب عکس</button>
        <input type="file" id="imgIn" style="display:none" onchange="updateImg(this)">
    </div>

    <div class="group-box">
        <h4>تماس (ستون راست)</h4>
        <input placeholder="موبایل" id="in_phone" oninput="update('phone', this.value)">
        <input placeholder="ایمیل" id="in_email" oninput="update('email', this.value)">
        <input placeholder="آدرس" id="in_addr" oninput="update('addr', this.value)">
    </div>

    <div class="group-box">
        <h4>سوابق شغلی <button class="btn btn-green" style="width:auto; float:left; padding:2px 6px;" onclick="addItem('works')">+</button></h4>
        <div id="list_works"></div>
    </div>

    <div class="group-box">
        <h4>تحصیلات <button class="btn btn-green" style="width:auto; float:left; padding:2px 6px;" onclick="addItem('edus')">+</button></h4>
        <div id="list_edus"></div>
    </div>

    <div class="group-box">
        <h4>مهارت‌ها <button class="btn btn-green" style="width:auto; float:left; padding:2px 6px;" onclick="addItem('skills')">+</button></h4>
        <div id="list_skills"></div>
    </div>
</div>

<div class="preview-area" id="renderZone"></div>

<script>
    // --- داده‌های اولیه ---
    let data = {
        name: "دانیال یوسفی",
        job: "مهندس نرم‌افزار",
        about: "برنامه‌نویس با تجربه و مسلط به تکنولوژی‌های روز. علاقه‌مند به حل مسائل پیچیده و کار تیمی.",
        phone: "09123456789",
        email: "email@example.com",
        addr: "تهران، ایران",
        photo: "",
        works: [
            { id: 1, title: "برنامه‌نویس ارشد", sub: "شرکت تکنولوژی برتر", date: "1400 - اکنون", desc: "مدیریت تیم فنی و توسعه پلتفرم‌های مقیاس‌پذیر." }
        ],
        edus: [
            { id: 1, title: "کارشناسی نرم‌افزار", sub: "دانشگاه تهران", date: "1395 - 1399", desc: "معدل 18" }
        ],
        skills: [
            { id: 1, title: "JavaScript", val: 90 },
            { id: 2, title: "React", val: 85 }
        ]
    };

    // --- توابع آپدیت ---
    function update(key, val) { data[key] = val; render(); }
    
    function updateImg(input) {
        if(input.files && input.files[0]) {
            let r = new FileReader();
            r.onload = e => { data.photo = e.target.result; render(); }
            r.readAsDataURL(input.files[0]);
        }
    }

    function addItem(type) {
        let newItem = type === 'skills' 
            ? { id: Date.now(), title: "مهارت جدید", val: 50 } 
            : { id: Date.now(), title: "عنوان", sub: "زیرعنوان", date: "تاریخ", desc: "توضیحات" };
        data[type].push(newItem);
        renderInputs(); render();
    }

    function delItem(type, id) {
        data[type] = data[type].filter(x => x.id != id);
        renderInputs(); render();
    }

    function updateList(type, id, key, val) {
        let item = data[type].find(x => x.id == id);
        if(item) { item[key] = val; render(); }
    }

    // --- رندر کردن پنل ادمین ---
    function renderInputs() {
        // پر کردن فیلدهای ثابت
        document.getElementById('in_name').value = data.name || "";
        document.getElementById('in_job').value = data.job || "";
        document.getElementById('in_about').value = data.about || "";
        document.getElementById('in_phone').value = data.phone || "";
        document.getElementById('in_email').value = data.email || "";
        document.getElementById('in_addr').value = data.addr || "";

        // ساخت لیست‌ها
        const makeList = (type, containerId, isSkill) => {
            let html = "";
            data[type].forEach(item => {
                if(isSkill) {
                    html += `
                        <div style="border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:5px;">
                            <input value="${item.title}" oninput="updateList('${type}', ${item.id}, 'title', this.value)" placeholder="نام" style="width:60%; display:inline-block">
                            <input value="${item.val}" type="number" oninput="updateList('${type}', ${item.id}, 'val', this.value)" style="width:20%; display:inline-block">
                            <button class="btn-red" onclick="delItem('${type}', ${item.id})">X</button>
                        </div>`;
                } else {
                    html += `
                        <div style="border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:5px;">
                            <input value="${item.title}" oninput="updateList('${type}', ${item.id}, 'title', this.value)" placeholder="عنوان">
                            <input value="${item.sub}" oninput="updateList('${type}', ${item.id}, 'sub', this.value)" placeholder="زیرعنوان">
                            <input value="${item.date}" oninput="updateList('${type}', ${item.id}, 'date', this.value)" placeholder="تاریخ">
                            <textarea oninput="updateList('${type}', ${item.id}, 'desc', this.value)" placeholder="توضیحات">${item.desc}</textarea>
                            <button class="btn-red" onclick="delItem('${type}', ${item.id})">حذف آیتم</button>
                        </div>`;
                }
            });
            document.getElementById(containerId).innerHTML = html;
        };

        makeList('works', 'list_works', false);
        makeList('edus', 'list_edus', false);
        makeList('skills', 'list_skills', true);
    }

    // --- رندر اصلی رزومه (موتور صفحه‌بندی) ---
    function render() {
        const zone = document.getElementById('renderZone');
        zone.innerHTML = "";

        // ساخت صفحه خام
        const createPage = (pageNum) => {
            let div = document.createElement('div');
            div.className = pageNum === 0 ? 'a4-page' : 'a4-page page-next';
            div.innerHTML = `
                <div class="header-top">
                    <div class="wave-shape-light"></div>
                    <div class="wave-shape"></div>
                    <div class="header-content">
                        <div class="header-text">
                            <h1>${data.name}</h1>
                            <p>${data.job}</p>
                        </div>
                    </div>
                </div>
                ${pageNum === 0 && data.photo ? `<div class="photo-box"><img src="${data.photo}"></div>` : ''}
                <div class="main-body">
                    <div class="col-sidebar" id="sidebar-${pageNum}"></div>
                    <div class="col-content" id="content-${pageNum}"></div>
                </div>
            `;
            return div;
        };

        let pages = [];
        let curPage = 0;
        pages.push(createPage(0));
        zone.appendChild(pages[0]);

        // 1. پر کردن سایدبار (راست)
        // نکته مهم: در نسخه قبلی باگ داشت. الان چک میکنیم اگر جا نشد بره صفحه بعد
        // اما معمولا سایدبار تماس و مهارت در یک صفحه جا میشه. برای سادگی و رفع باگ، همه رو اول میریزیم تو صفحه 1
        // اگر خیلی زیاد بود، سیستم اسکرول میخوره ولی محتوا غیب نمیشه.
        const sidebar = pages[0].querySelector(`#sidebar-0`);
        
        // تماس
        let contactHtml = `<div class="sec-title"><i class="fas fa-address-book"></i> اطلاعات تماس</div>`;
        if(data.phone) contactHtml += `<div class="contact-row"><span>${data.phone}</span> <i class="fas fa-mobile"></i></div>`;
        if(data.email) contactHtml += `<div class="contact-row"><span>${data.email}</span> <i class="fas fa-envelope"></i></div>`;
        if(data.addr) contactHtml += `<div class="contact-row"><span>${data.addr}</span> <i class="fas fa-map-marker-alt"></i></div>`;
        
        let cDiv = document.createElement('div');
        cDiv.style.width = '100%';
        cDiv.innerHTML = contactHtml + '<br>';
        sidebar.appendChild(cDiv);

        // مهارت‌ها
        if(data.skills.length > 0) {
            let sDiv = document.createElement('div');
            sDiv.style.width = '100%';
            let sHtml = `<div class="sec-title"><i class="fas fa-lightbulb"></i> مهارت‌ها</div>`;
            data.skills.forEach(s => {
                sHtml += `
                    <div class="skill-row">
                        <div class="skill-txt"><span>${s.title}</span><span>${s.val}%</span></div>
                        <div class="skill-bar"><div class="skill-fill" style="width:${s.val}%"></div></div>
                    </div>`;
            });
            sDiv.innerHTML = sHtml;
            sidebar.appendChild(sDiv);
        }

        // 2. پر کردن محتوا (چپ) - با قابلیت صفحه بندی
        let contentCol = pages[0].querySelector(`#content-0`);
        let blocks = [];
        
        if(data.about) blocks.push({type:'txt', title:'درباره من', txt: data.about, icon:'fa-user'});
        if(data.works.length) blocks.push({type:'list', title:'سوابق شغلی', items: data.works, icon:'fa-briefcase'});
        if(data.edus.length) blocks.push({type:'list', title:'سوابق تحصیلی', items: data.edus, icon:'fa-graduation-cap'});

        blocks.forEach(block => {
            // تیتر
            let title = document.createElement('div');
            title.className = 'sec-title';
            title.innerHTML = `<i class="fas ${block.icon}"></i> ${block.title}`;
            contentCol.appendChild(title);

            // چک ارتفاع
            if(contentCol.scrollHeight > 1050) { // ارتفاع امن محتوا
                contentCol.removeChild(title);
                curPage++;
                pages.push(createPage(curPage));
                zone.appendChild(pages[curPage]);
                contentCol = pages[curPage].querySelector(`#content-${curPage}`);
                contentCol.appendChild(title);
            }

            // محتوا
            if(block.type === 'txt') {
                let p = document.createElement('p');
                p.className = 'about-txt';
                p.innerText = block.txt;
                contentCol.appendChild(p);
            } else {
                block.items.forEach(item => {
                    let d = document.createElement('div');
                    d.className = 'job-item';
                    d.innerHTML = `
                        <div class="job-title">${item.title}</div>
                        <div class="job-sub">${item.sub}</div>
                        <span class="job-date">${item.date}</span>
                        <div class="job-desc">${item.desc}</div>
                    `;
                    contentCol.appendChild(d);
                    
                    // چک شکست صفحه برای هر آیتم
                    // 1123px ارتفاع A4 است. ما حدود 1080 میگیریم که حاشیه پایین امن باشه
                    let pageEl = pages[curPage];
                    if(pageEl.scrollHeight > 1110) {
                        contentCol.removeChild(d);
                        curPage++;
                        pages.push(createPage(curPage));
                        zone.appendChild(pages[curPage]);
                        contentCol = pages[curPage].querySelector(`#content-${curPage}`);
                        contentCol.appendChild(d);
                    }
                });
            }
        });
    }

    // --- ذخیره و بازیابی ---
    function saveData() {
        let json = JSON.stringify(data);
        let blob = new Blob([json], {type: "application/json"});
        let url = URL.createObjectURL(blob);
        let a = document.createElement('a');
        a.href = url;
        a.download = "Resume_Project.sedat";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        alert('فایل پروژه دانلود شد!');
    }

    function loadData(input) {
        if(!input.files[0]) return;
        let r = new FileReader();
        r.onload = e => {
            try {
                data = JSON.parse(e.target.result);
                renderInputs();
                render();
                alert('پروژه بارگذاری شد.');
            } catch(err) {
                alert('فایل خراب است.');
            }
        }
        r.readAsText(input.files[0]);
    }

    // شروع
    renderInputs();
    render();
</script>
</body>
</html>
