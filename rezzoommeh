<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>رزومه ساز هوشمند طرح دانیال</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />
    <style>
        /* --- تنظیمات کلی --- */
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; background: #0f172a; font-family: 'Vazir', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        
        /* --- پنل ویرایش (سمت راست) --- */
        .editor-panel {
            width: 350px;
            background: #1e293b;
            color: #fff;
            padding: 20px;
            overflow-y: auto;
            border-left: 4px solid #0ea5e9;
            z-index: 10;
        }
        .input-group { margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        .input-group h4 { margin: 0 0 10px 0; color: #0ea5e9; font-size: 14px; border-bottom: 1px dashed #475569; padding-bottom: 5px; }
        input, textarea { width: 100%; background: #334155; border: 1px solid #475569; color: white; padding: 8px; border-radius: 4px; margin-bottom: 8px; font-family: 'Vazir'; }
        button { cursor: pointer; border: none; padding: 5px 10px; border-radius: 4px; font-family: 'Vazir'; }
        .btn-add { background: #22c55e; color: white; width: 100%; margin-top: 5px; }
        .btn-print { background: #0ea5e9; color: white; width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px; font-weight: bold; }
        .btn-del { background: #ef4444; color: white; font-size: 10px; }

        /* --- ناحیه پیش‌نمایش (سمت چپ) --- */
        .preview-area {
            flex: 1;
            background: #64748b;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            gap: 20px;
        }

        /* --- کاغذ A4 --- */
        .page {
            width: 210mm;
            height: 296.5mm; /* دقیق A4 */
            background: white;
            position: relative;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            overflow: hidden; /* مخفی کردن سرریز برای شکست صفحه */
            display: flex;
            flex-direction: column;
        }

        /* --- طراحی رزومه (تم دانیال) --- */
        /* هدر */
        .header {
            height: 160px;
            position: relative;
            background: white;
            z-index: 1;
        }
        /* موج آبی پس‌زمینه */
        .header-bg {
            position: absolute;
            top: 0; right: 0; left: 0; bottom: 0;
            background: #0ea5e9;
            clip-path: polygon(0 0, 100% 0, 100% 75%, 0% 100%);
            z-index: -1;
        }
        
        .header-content {
            display: flex;
            padding: 30px 40px 0 40px;
            align-items: flex-start;
            color: white;
            justify-content: space-between;
        }

        .profile-photo {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            border: 5px solid white;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: absolute;
            left: 40px;
            top: 30px;
            z-index: 10;
        }

        .name-box h1 { margin: 0; font-size: 28px; font-weight: bold; }
        .name-box p { margin: 5px 0 0 0; font-size: 16px; opacity: 0.9; }

        /* بدنه اصلی */
        .body-container {
            display: flex;
            flex: 1;
            padding: 0;
            height: 100%; /* پر کردن فضای باقی مانده */
        }

        /* ستون راست (اصلی) */
        .col-main {
            width: 63%;
            padding: 40px 30px 20px 0; /* padding right removed in flex layout, applied manually */
            padding-right: 30px;
            padding-left: 15px;
        }

        /* ستون چپ (کناری) */
        .col-side {
            width: 37%;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 80px 20px 20px 20px; /* Top padding زیاد بخاطر عکس */
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* راست چین کردن محتوا در ستون چپ */
        }
        
        /* در صفحات بعدی عکس نداریم، پس پدینگ کمتر میشه */
        .page:not(:first-child) .col-side { padding-top: 30px; }
        .page:not(:first-child) .header { display: none; } /* هدر فقط صفحه اول */
        .page:not(:first-child) .col-main { padding-top: 40px; }

        /* المان‌های داخلی */
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #0f172a;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
            border-bottom: 2px solid #0ea5e9;
            padding-bottom: 5px;
            width: 100%;
        }
        .section-title i { color: #0ea5e9; font-size: 18px; }

        .timeline-item {
            position: relative;
            padding-right: 15px;
            margin-bottom: 15px;
            border-right: 2px solid #e2e8f0;
        }
        .timeline-item::before {
            content: ''; position: absolute; right: -6px; top: 0;
            width: 10px; height: 10px; background: #0ea5e9; border-radius: 50%;
        }
        .t-title { font-weight: bold; font-size: 14px; color: #334155; }
        .t-date { font-size: 11px; color: #0ea5e9; margin-bottom: 5px; display: block; }
        .t-desc { font-size: 12px; color: #64748b; line-height: 1.6; text-align: justify; }

        /* مهارت‌ها و تماس */
        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #334155;
            margin-bottom: 12px;
            width: 100%;
            flex-direction: row-reverse; /* آیکون سمت راست */
        }
        .skill-box { width: 100%; margin-bottom: 10px; }
        .skill-name { font-size: 12px; margin-bottom: 3px; display: flex; justify-content: space-between; }
        .progress-bg { background: #e2e8f0; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-fill { background: #0ea5e9; height: 100%; }

        /* --- مد پرینت --- */
        @media print {
            body { background: white; height: auto; display: block; }
            .editor-panel, .preview-area { display: none; } /* مخفی کردن ادیتور */
            .preview-area { padding: 0; display: block; }
            .page { 
                margin: 0; 
                box-shadow: none; 
                page-break-after: always; 
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            /* نمایش مستقیم صفحات */
            #printContainer { display: block; }
        }
    </style>
</head>
<body>

    <div class="editor-panel">
        <button class="btn-print" onclick="window.print()"><i class="fas fa-print"></i> دانلود PDF / پرینت</button>
        
        <div class="input-group">
            <h4>اطلاعات پایه</h4>
            <input placeholder="نام و نام خانوادگی" id="in_name" oninput="updateResume()">
            <input placeholder="عنوان شغلی" id="in_job" oninput="updateResume()">
            <textarea placeholder="خلاصه درباره من" id="in_about" rows="3" oninput="updateResume()"></textarea>
            <button onclick="document.getElementById('fileIn').click()" style="width:100%; background:#334155; color:white; margin-top:5px">انتخاب عکس</button>
            <input type="file" id="fileIn" style="display:none" accept="image/*" onchange="loadPhoto(this)">
        </div>

        <div class="input-group">
            <h4>اطلاعات تماس</h4>
            <input placeholder="شماره تماس" id="in_phone" oninput="updateResume()">
            <input placeholder="ایمیل" id="in_email" oninput="updateResume()">
            <input placeholder="شهر / آدرس" id="in_addr" oninput="updateResume()">
        </div>

        <div class="input-group">
            <h4>سوابق شغلی <button class="btn-add" onclick="addWork()">+</button></h4>
            <div id="workList"></div>
        </div>

        <div class="input-group">
            <h4>تحصیلات <button class="btn-add" onclick="addEdu()">+</button></h4>
            <div id="eduList"></div>
        </div>

        <div class="input-group">
            <h4>مهارت‌ها <button class="btn-add" onclick="addSkill()">+</button></h4>
            <div id="skillList"></div>
        </div>
    </div>

    <div class="preview-area" id="printContainer">
        </div>

<script>
    // --- داده‌های پیش‌فرض ---
    const data = {
        name: "دانیال یوسفی",
        job: "مهندس نرم‌افزار",
        about: "مهندس نرم‌افزار با بیش از ۶ سال تجربه در توسعه نرم‌افزارهای مقیاس‌پذیر. متخصص در فریم‌ورک‌های مدرن مانند React و Django. مشتاق یادگیری تکنولوژی‌های جدید.",
        phone: "09121234567",
        email: "info@resume-fa.ir",
        addr: "تهران - تجریش",
        photo: "",
        works: [
            { id: 1, title: "مهندس نرم‌افزار ارشد", sub: "شرکت فناوری نوین | تهران", date: "1398 - اکنون", desc: "طراحی و توسعه پلتفرم وب با React که زمان بارگذاری را ۳۰ درصد کاهش داد." },
            { id: 2, title: "توسعه دهنده نرم‌افزار", sub: "استارتاپ خلاق", date: "1395 - 1398", desc: "توسعه اپلیکیشن موبایل با فلاتر که بیش از 50 هزار دانلود داشت." }
        ],
        edus: [
            { id: 1, title: "کارشناسی ارشد علوم کامپیوتر", sub: "دانشگاه صنعتی شریف", date: "1396 - 1398", desc: "معدل: 18.69" }
        ],
        skills: [
            { id: 1, title: "JavaScript / React", val: 90 },
            { id: 2, title: "Python / Django", val: 85 },
            { id: 3, title: "Git / Docker", val: 75 },
            { id: 4, title: "Teamwork", val: 100 }
        ]
    };

    // --- توابع اولیه ---
    function init() {
        // پر کردن اینپوت‌ها با داده‌های پیش‌فرض
        document.getElementById('in_name').value = data.name;
        document.getElementById('in_job').value = data.job;
        document.getElementById('in_about').value = data.about;
        document.getElementById('in_phone').value = data.phone;
        document.getElementById('in_email').value = data.email;
        document.getElementById('in_addr').value = data.addr;
        
        renderListEditors();
        updateResume();
    }

    function renderListEditors() {
        renderEditorItems('workList', data.works, 'works');
        renderEditorItems('eduList', data.edus, 'edus');
        renderEditorItems('skillList', data.skills, 'skills', true);
    }

    function renderEditorItems(containerId, items, key, isSkill = false) {
        const c = document.getElementById(containerId);
        c.innerHTML = '';
        items.forEach((item, index) => {
            const div = document.createElement('div');
            div.style.borderBottom = "1px solid #555";
            div.style.paddingBottom = "5px";
            div.style.marginBottom = "5px";
            
            if(isSkill) {
                div.innerHTML = `
                    <input value="${item.title}" oninput="updateItem('${key}', ${index}, 'title', this.value)" placeholder="نام مهارت">
                    <input type="range" value="${item.val}" oninput="updateItem('${key}', ${index}, 'val', this.value)">
                    <button class="btn-del" onclick="delItem('${key}', ${index})">حذف</button>
                `;
            } else {
                div.innerHTML = `
                    <input value="${item.title}" oninput="updateItem('${key}', ${index}, 'title', this.value)" placeholder="عنوان">
                    <input value="${item.sub}" oninput="updateItem('${key}', ${index}, 'sub', this.value)" placeholder="زیرعنوان">
                    <input value="${item.date}" oninput="updateItem('${key}', ${index}, 'date', this.value)" placeholder="تاریخ">
                    <textarea oninput="updateItem('${key}', ${index}, 'desc', this.value)" placeholder="توضیحات">${item.desc}</textarea>
                    <button class="btn-del" onclick="delItem('${key}', ${index})">حذف</button>
                `;
            }
            c.appendChild(div);
        });
    }

    // --- هسته اصلی: رندر رزومه و صفحه‌بندی ---
    function updateResume() {
        const container = document.getElementById('printContainer');
        container.innerHTML = ''; // پاک کردن همه صفحات

        // 1. ایجاد صفحه اول
        let pages = [createPage(1)];
        container.appendChild(pages[0]);

        // 2. پر کردن هدر صفحه اول
        fillHeader(pages[0]);

        // 3. آماده‌سازی پشته (Queue) برای محتوا
        // محتوای ستون اصلی
        let mainContentQueue = [];
        if(data.about) mainContentQueue.push({type: 'text', title: 'درباره من', text: data.about});
        if(data.edus.length) mainContentQueue.push({type: 'list', title: 'سوابق تحصیلی', items: data.edus, icon: 'fa-graduation-cap'});
        if(data.works.length) mainContentQueue.push({type: 'list', title: 'سوابق شغلی', items: data.works, icon: 'fa-briefcase'});

        // محتوای ستون کناری
        let sideContentQueue = [];
        sideContentQueue.push({type: 'contact'});
        if(data.skills.length) sideContentQueue.push({type: 'skills', title: 'مهارت‌ها', items: data.skills});

        // 4. توزیع محتوا در صفحات (الگوریتم صفحه‌بندی)
        
        // الف) پر کردن ستون اصلی
        let pageIndex = 0;
        let currentMainCol = pages[0].querySelector('.col-main');
        
        mainContentQueue.forEach(block => {
            // تیتر بخش
            let titleHTML = `<div class="section-title"><i class="fas ${block.icon || 'fa-user'}"></i> ${block.title}</div>`;
            if(block.type === 'contact') return; // تماس میره تو سایدبار

            // تست جا شدن تیتر
            let tempDiv = document.createElement('div');
            tempDiv.innerHTML = titleHTML;
            currentMainCol.appendChild(tempDiv);
            
            // اگر تیتر هم جا نشد، برو صفحه بعد
            if (checkOverflow(pages[pageIndex])) {
                currentMainCol.removeChild(tempDiv);
                pageIndex++;
                if(!pages[pageIndex]) { pages[pageIndex] = createPage(pageIndex+1); container.appendChild(pages[pageIndex]); }
                currentMainCol = pages[pageIndex].querySelector('.col-main');
                currentMainCol.appendChild(tempDiv);
            }

            // محتوای داخلی بلوک
            if (block.type === 'text') {
                let p = document.createElement('p');
                p.style.textAlign = 'justify';
                p.style.lineHeight = '1.8';
                p.style.fontSize = '13px';
                p.innerText = block.text;
                currentMainCol.appendChild(p);
                 if(checkOverflow(pages[pageIndex])) {
                     // انتقال متن به صفحه بعد (ساده‌سازی: کل متن جابجا شود)
                     currentMainCol.removeChild(p);
                     // صفحه جدید... (کد تکراری برای ساخت صفحه جدید رو تابع کنیم بهتره ولی اینجا خطی مینویسم)
                     pageIndex++;
                     if(!pages[pageIndex]) { pages[pageIndex] = createPage(pageIndex+1); container.appendChild(pages[pageIndex]); }
                     currentMainCol = pages[pageIndex].querySelector('.col-main');
                     // تیتر رو هم بیاریم؟ معمولا نه.
                     currentMainCol.appendChild(p);
                 }
            } else if (block.type === 'list') {
                block.items.forEach(item => {
                    let itemDiv = document.createElement('div');
                    itemDiv.className = 'timeline-item';
                    itemDiv.innerHTML = `
                        <div class="t-title">${item.title}</div>
                        <span class="t-date">${item.sub} | ${item.date}</span>
                        <div class="t-desc">${item.desc}</div>
                    `;
                    currentMainCol.appendChild(itemDiv);
                    
                    if (checkOverflow(pages[pageIndex])) {
                        currentMainCol.removeChild(itemDiv);
                        pageIndex++;
                        if(!pages[pageIndex]) { pages[pageIndex] = createPage(pageIndex+1); container.appendChild(pages[pageIndex]); }
                        currentMainCol = pages[pageIndex].querySelector('.col-main');
                        currentMainCol.appendChild(itemDiv);
                    }
                });
            }
        });

        // ب) پر کردن ستون کناری (Sidebar)
        // ریست کردن ایندکس صفحه برای شروع پر کردن سایدبار از صفحه اول
        pageIndex = 0;
        let currentSideCol = pages[0].querySelector('.col-side');

        sideContentQueue.forEach(block => {
            if (block.type === 'contact') {
                let contactHTML = `
                    <div class="section-title" style="margin-top:0">اطلاعات تماس</div>
                    <div class="contact-item"><span>${document.getElementById('in_phone').value}</span> <i class="fas fa-mobile-alt"></i></div>
                    <div class="contact-item"><span>${document.getElementById('in_email').value}</span> <i class="fas fa-envelope"></i></div>
                    <div class="contact-item"><span>${document.getElementById('in_addr').value}</span> <i class="fas fa-map-marker-alt"></i></div>
                    <br>
                `;
                let div = document.createElement('div');
                div.style.width = '100%';
                div.innerHTML = contactHTML;
                currentSideCol.appendChild(div);
                // معمولا تماس کوچیکه و صفحه اول جا میشه، چک نمی‌کنیم
            } 
            else if (block.type === 'skills') {
                let titleDiv = document.createElement('div');
                titleDiv.className = 'section-title';
                titleDiv.innerHTML = 'مهارت‌ها';
                currentSideCol.appendChild(titleDiv);

                block.items.forEach(skill => {
                    let sDiv = document.createElement('div');
                    sDiv.className = 'skill-box';
                    sDiv.innerHTML = `
                        <div class="skill-name"><span>${skill.title}</span><span>${skill.val}%</span></div>
                        <div class="progress-bg"><div class="progress-fill" style="width:${skill.val}%"></div></div>
                    `;
                    currentSideCol.appendChild(sDiv);

                    // چک کردن ارتفاع A4 (حدود 1120 پیکسل)
                    // نکته: برای سایدبار چون پدینگ بالا داره در صفحه اول، باید حواسمون باشه
                    // اینجا ساده چک میکنیم که از ارتفاع صفحه نزنه بیرون
                    let pageH = pages[pageIndex].getBoundingClientRect().height; // ارتفاع واقعی المان
                    // اما چون scale نداره، scrollHeight همون ارتفاع محتواست + پدینگ
                    // ارتفاع استاندارد A4 حدود 1122px در 96DPI است.
                    
                    if (pages[pageIndex].scrollHeight > 1125) { 
                        currentSideCol.removeChild(sDiv);
                        pageIndex++;
                        // اگر صفحه بعدی وجود نداشت (یعنی محتوای اصلی تموم شده ولی سایدبار مونده) باید بسازیم
                        if(!pages[pageIndex]) { pages[pageIndex] = createPage(pageIndex+1); container.appendChild(pages[pageIndex]); }
                        currentSideCol = pages[pageIndex].querySelector('.col-side');
                        currentSideCol.appendChild(sDiv);
                    }
                });
            }
        });
    }

    // ساخت یک صفحه خام
    function createPage(num) {
        const page = document.createElement('div');
        page.className = 'page';
        page.innerHTML = `
            ${num === 1 ? '<div class="header"><div class="header-bg"></div><div class="header-content"><div class="name-box"><h1 id="out_name"></h1><p id="out_job"></p></div></div><img id="out_img" class="profile-photo" src="https://via.placeholder.com/150"></div>' : ''}
            <div class="body-container">
                <div class="col-main"></div>
                <div class="col-side"></div>
            </div>
        `;
        return page;
    }

    function fillHeader(pageElement) {
        pageElement.querySelector('#out_name').innerText = document.getElementById('in_name').value;
        pageElement.querySelector('#out_job').innerText = document.getElementById('in_job').value;
        const img = pageElement.querySelector('#out_img');
        if(data.photo) img.src = data.photo;
        else img.style.display = 'none';
        
        if(data.photo) img.style.display = 'block';
    }

    function checkOverflow(pageElement) {
        // ارتفاع محتوا از 1123 پیکسل (A4) بیشتر شده؟
        return pageElement.scrollHeight > 1124; 
    }

    // --- مدیریت داده‌ها (CRUD) ---
    function updateItem(list, index, key, value) {
        data[list][index][key] = value;
        updateResume();
    }
    function addWork() {
        data.works.push({ title: "عنوان شغلی", sub: "نام شرکت", date: "تاریخ", desc: "توضیحات..." });
        renderListEditors(); updateResume();
    }
    function addEdu() {
        data.edus.push({ title: "رشته تحصیلی", sub: "دانشگاه", date: "تاریخ", desc: "معدل/توضیحات" });
        renderListEditors(); updateResume();
    }
    function addSkill() {
        data.skills.push({ title: "مهارت جدید", val: 50 });
        renderListEditors(); updateResume();
    }
    function delItem(list, index) {
        data[list].splice(index, 1);
        renderListEditors(); updateResume();
    }
    function loadPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                data.photo = e.target.result;
                updateResume();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // اجرا در شروع
    window.onload = init;
</script>
</body>
</html>
