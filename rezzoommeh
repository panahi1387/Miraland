<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رزومه ساز آنلاین - نسخه اصلاح شده</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #0ea5e9;
            --bg-body: #eef2f6; /* رنگ روشن برای کل صفحه */
            --bg-sidebar: #ffffff;
            --text-main: #334155;
            --border-color: #cbd5e1;
        }

        * { box-sizing: border-box; outline: none; }

        body { 
            margin: 0; padding: 0; 
            font-family: 'Vazir', sans-serif; 
            background-color: var(--bg-body); 
            height: 100vh; 
            display: flex; 
            overflow: hidden; /* حذف اسکرول بادی */
            color: var(--text-main);
        }

        /* --- سایدبار (راست) --- */
        .editor-sidebar {
            width: 400px;
            min-width: 350px; /* جلوگیری از جمع شدن */
            background: var(--bg-sidebar);
            height: 100vh;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            z-index: 20;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }

        .sidebar-header {
            padding: 20px;
            background: #fff;
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }

        /* استایل فرم‌ها */
        .group-box {
            background: #fff; border: 1px solid var(--border-color);
            border-radius: 8px; padding: 15px; margin-bottom: 20px;
        }
        .group-box h4 { margin: 0 0 15px 0; border-bottom: 2px solid #f1f5f9; padding-bottom: 8px; }

        input, textarea {
            width: 100%; padding: 10px; margin-bottom: 10px;
            border: 1px solid #e2e8f0; border-radius: 6px; font-family: 'Vazir';
        }
        .btn {
            padding: 10px; border: none; border-radius: 6px; cursor: pointer;
            font-family: 'Vazir'; width: 100%; margin-bottom: 5px;
        }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-danger { background: #ef4444; color: white; width: auto; padding: 5px 10px; font-size: 12px; }

        /* --- محیط پیش‌نمایش (چپ) --- */
        .preview-wrapper {
            flex: 1;
            background-color: #cbd5e1; /* رنگ طوسی مشخص برای تشخیص فضا */
            background-image: radial-gradient(#94a3b8 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* شروع از بالا */
            overflow: auto; /* اسکرول داخلی */
            padding: 60px 20px;
            position: relative;
        }

        /* دکمه‌های زوم */
        .zoom-controls {
            position: fixed; bottom: 30px; left: 30px;
            background: #fff; padding: 10px; border-radius: 50px;
            display: flex; gap: 10px; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100;
        }
        .zoom-btn { background: #f1f5f9; border: none; cursor: pointer; width: 30px; height: 30px; border-radius: 50%; font-weight: bold;}

        /* --- کاغذ A4 --- */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white !important; /* حتما سفید باشه */
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            position: relative;
            margin-bottom: 40px;
            /* ترنزیشن حذف شد تا پرش نداشته باشه */
            flex-shrink: 0; /* جلوگیری از جمع شدن در فلکس */
        }

        /* --- استایل داخلی رزومه --- */
        .header-top { height: 160px; position: relative; background: #f8fafc; overflow: hidden; }
        .shape-1 {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-color);
            clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
        }
        .header-content {
            position: relative; z-index: 10; padding: 30px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-txt h1 { margin: 0; color: white; font-size: 32px; }
        .header-txt p { margin: 5px 0 0; color: rgba(255,255,255,0.9); font-size: 16px; }
        .user-photo {
            width: 110px; height: 110px; border-radius: 50%;
            border: 4px solid white; background: #fff; object-fit: cover;
        }

        .main-body { display: flex; min-height: 800px; }
        .col-side { width: 32%; background: #f1f5f9; padding: 30px 20px; border-left: 1px solid #e2e8f0; }
        .col-main { width: 68%; padding: 30px; }

        .sec-head {
            font-size: 16px; font-weight: bold; color: #1e293b;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 5px; margin-bottom: 15px; margin-top: 10px;
        }
        
        .timeline-box { margin-bottom: 20px; border-right: 2px solid #e2e8f0; padding-right: 15px; position: relative; }
        .timeline-box::before {
            content: ''; position: absolute; right: -6px; top: 5px;
            width: 10px; height: 10px; background: var(--secondary-color); border-radius: 50%;
        }
        .t-title { font-weight: bold; font-size: 14px; }
        .t-date { font-size: 11px; color: #64748b; display: block; margin-bottom: 5px; }
        .t-desc { font-size: 13px; color: #334155; line-height: 1.6; text-align: justify; }

        /* چاپ */
        @media print {
            body { display: block; background: white; height: auto; overflow: visible; }
            .editor-sidebar, .zoom-controls { display: none !important; }
            .preview-wrapper { display: block; padding: 0; background: white; overflow: visible; }
            .a4-page { margin: 0; box-shadow: none; width: 100%; page-break-after: always; transform: none !important; }
        }
    </style>
</head>
<body>

<div class="editor-sidebar">
    <div class="sidebar-header">
        <h3 style="margin:0">ویرایشگر</h3>
        <button class="btn-primary" style="width:auto; padding:5px 15px" onclick="window.print()">دانلود PDF</button>
    </div>

    <div class="sidebar-content">
        <div class="group-box">
            <h4>مشخصات</h4>
            <input placeholder="نام کامل" id="in_name" oninput="up('name',this.value)">
            <input placeholder="عنوان شغلی" id="in_job" oninput="up('job',this.value)">
            <textarea placeholder="درباره من" rows="3" id="in_about" oninput="up('about',this.value)"></textarea>
            <button class="btn" style="border:1px dashed #ccc" onclick="document.getElementById('f_img').click()">انتخاب عکس</button>
            <input type="file" id="f_img" hidden onchange="upImg(this)">
        </div>

        <div class="group-box">
            <h4>اطلاعات تماس</h4>
            <input placeholder="تلفن" id="in_phone" oninput="up('phone',this.value)">
            <input placeholder="ایمیل" id="in_email" oninput="up('email',this.value)">
            <input placeholder="آدرس" id="in_addr" oninput="up('addr',this.value)">
        </div>

        <div class="group-box">
            <h4>سوابق شغلی <button class="btn-primary" style="float:left; width:auto; padding:0 8px" onclick="add('works')">+</button></h4>
            <div id="list_works"></div>
        </div>

        <div class="group-box">
            <h4>مهارت‌ها <button class="btn-primary" style="float:left; width:auto; padding:0 8px" onclick="add('skills')">+</button></h4>
            <div id="list_skills"></div>
        </div>
    </div>
</div>

<div class="preview-wrapper" id="prevWrap">
    <div id="renderZone" style="transform-origin: top center; transition: transform 0.1s;"></div>
    
    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoom(-0.1)">-</button>
        <button class="zoom-btn" onclick="fitZoom()" style="width:auto; padding:0 10px; font-size:12px">Fit</button>
        <button class="zoom-btn" onclick="zoom(0.1)">+</button>
    </div>
</div>

<script>
    // داده‌های پیش‌فرض برای تست
    let data = {
        name: "کاربر آزمایشی",
        job: "مدیر پروژه",
        about: "توضیحات کوتاه درباره من...",
        phone: "09120000000",
        email: "email@example.com",
        addr: "تهران",
        photo: "",
        works: [
            { id: 1, title: "عنوان شغل", date: "1402", desc: "توضیحات مسئولیت‌ها..." }
        ],
        skills: [
            { id: 1, title: "HTML", val: 80 }
        ]
    };

    function up(k, v) { data[k] = v; render(); }
    function upImg(el) {
        if(el.files[0]) {
            let r = new FileReader();
            r.onload = e => { data.photo = e.target.result; render(); };
            r.readAsDataURL(el.files[0]);
        }
    }

    function add(type) {
        let item = type === 'skills' 
            ? { id: Date.now(), title: "مهارت جدید", val: 50 }
            : { id: Date.now(), title: "شغل جدید", date: "تاریخ", desc: "توضیحات" };
        data[type].push(item);
        renderInputs(); render();
    }
    function del(type, id) {
        data[type] = data[type].filter(x => x.id != id);
        renderInputs(); render();
    }
    function upList(type, id, k, v) {
        let f = data[type].find(x => x.id == id);
        if(f) { f[k] = v; render(); }
    }

    function renderInputs() {
        document.getElementById('in_name').value = data.name || "";
        document.getElementById('in_job').value = data.job || "";
        document.getElementById('in_about').value = data.about || "";
        document.getElementById('in_phone').value = data.phone || "";
        document.getElementById('in_email').value = data.email || "";
        document.getElementById('in_addr').value = data.addr || "";

        let wHtml = "";
        data.works.forEach(x => {
            wHtml += `<div style="background:#f8fafc; padding:8px; border:1px solid #eee; margin-bottom:5px; border-radius:4px">
                <input value="${x.title}" oninput="upList('works',${x.id},'title',this.value)" placeholder="عنوان">
                <textarea rows="2" oninput="upList('works',${x.id},'desc',this.value)">${x.desc}</textarea>
                <button class="btn-danger" onclick="del('works',${x.id})">حذف</button>
            </div>`;
        });
        document.getElementById('list_works').innerHTML = wHtml;

        let sHtml = "";
        data.skills.forEach(x => {
            sHtml += `<div style="display:flex; gap:5px; margin-bottom:5px">
                <input value="${x.title}" oninput="upList('skills',${x.id},'title',this.value)">
                <input type="number" value="${x.val}" style="width:50px" oninput="upList('skills',${x.id},'val',this.value)">
                <button class="btn-danger" onclick="del('skills',${x.id})">x</button>
            </div>`;
        });
        document.getElementById('list_skills').innerHTML = sHtml;
    }

    function render() {
        const zone = document.getElementById('renderZone');
        // ساختار ساده تک صفحه‌ای برای جلوگیری از پیچیدگی
        let html = `
        <div class="a4-page">
            <div class="header-top">
                <div class="shape-1"></div>
                <div class="header-content">
                    <div class="header-txt">
                        <h1>${data.name}</h1>
                        <p>${data.job}</p>
                    </div>
                    ${data.photo ? `<img src="${data.photo}" class="user-photo">` : '<div class="user-photo" style="background:#eee"></div>'}
                </div>
            </div>
            <div class="main-body">
                <div class="col-side">
                    <div class="sec-head">تماس</div>
                    <div style="font-size:13px; line-height:2">${data.phone}<br>${data.email}<br>${data.addr}</div>
                    <br>
                    <div class="sec-head">مهارت‌ها</div>
                    ${data.skills.map(s => `
                        <div style="margin-bottom:8px; font-size:13px">
                            <div style="display:flex; justify-content:space-between"><span>${s.title}</span><span>${s.val}%</span></div>
                            <div style="background:#e2e8f0; height:6px; border-radius:3px; margin-top:2px"><div style="background:var(--secondary-color); width:${s.val}%; height:100%; border-radius:3px"></div></div>
                        </div>
                    `).join('')}
                </div>
                <div class="col-main">
                    ${data.about ? `<div class="sec-head">درباره من</div><p class="t-desc">${data.about}</p>` : ''}
                    
                    ${data.works.length ? `<div class="sec-head">سوابق شغلی</div>` : ''}
                    ${data.works.map(w => `
                        <div class="timeline-box">
                            <div class="t-title">${w.title}</div>
                            <span class="t-date">${w.date}</span>
                            <div class="t-desc">${w.desc}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        `;
        zone.innerHTML = html;
    }

    // --- مدیریت زوم اصلاح شده ---
    let currentScale = 1;
    
    function fitZoom() {
        const wrapper = document.getElementById('prevWrap');
        // اگر عرض Wrapper اشتباهی 0 بود (مثلا در لحظه لود اولیه)، یک مقدار پیش‌فرض در نظر بگیر
        const availableWidth = wrapper.clientWidth || 800; 
        
        // عرض A4 استاندارد حدود 794 پیکسل است
        const a4Width = 810; // با کمی حاشیه
        
        // محاسبه نسبت
        let scale = (availableWidth - 60) / a4Width;
        
        // جلوگیری از کوچک شدن بیش از حد یا منفی شدن
        if (scale < 0.3) scale = 0.4; 
        if (scale > 1.2) scale = 1.2;
        
        currentScale = scale;
        applyZoom();
    }

    function zoom(change) {
        currentScale += change;
        if(currentScale < 0.3) currentScale = 0.3;
        applyZoom();
    }

    function applyZoom() {
        const zone = document.getElementById('renderZone');
        zone.style.transform = `scale(${currentScale})`;
        // تنظیم فاصله پایین برای اسکرول شدن کامل رزومه
        zone.style.marginBottom = `${(currentScale * 1200) - 1200}px`; 
        zone.style.marginRight = "0px"; // جلوگیری از شیفت شدن
    }

    // شروع برنامه با تاخیر کوتاه برای اطمینان از لود شدن
    window.onload = () => {
        renderInputs();
        render();
        // دوبار فراخوانی برای اطمینان از لود کامل CSS
        setTimeout(fitZoom, 100);
        setTimeout(fitZoom, 1000);
    };
    
    // وقتی سایز پنجره عوض شد دوباره فیت کن
    window.onresize = () => {
        fitZoom();
    };

</script>
</body>
</html>
